<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Streamer vs. Chat — Zombies</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    .hero {
      position: relative;
      min-height: 100dvh;
      display: grid; place-items: center;
      overflow: hidden;
    }
    .hero-inner { text-align: center; padding: 100px 20px 60px; }
    .title {
      font-weight: 800; font-size: clamp(28px, 6vw, 56px);
      letter-spacing: .5px;
      background: linear-gradient(90deg, #fff, #a5b4fc 35%, #99f6e4 70%);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-shadow: 0 10px 40px rgba(0,0,0,.45);
    }
    .subtitle { color: var(--muted); margin-top: 10px; max-width: 900px; margin-inline: auto; }
    .cta { margin-top: 26px; display: inline-flex; gap: 10px; flex-wrap: wrap; }
    .cta a { text-decoration: none; }
    .btn-xl { padding: 14px 18px; font-size: 16px; border-radius: 14px; border: 1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.08)); box-shadow: 0 12px 30px rgba(0,0,0,.35); }
    .btn-xl.primary { color: var(--teal); border-color: color-mix(in oklab, var(--teal) 35%, transparent); }
    .btn-xl.secondary { color: #c3c7d1; }

    /* Floating blobs */
    .blob {
      position: absolute; width: 60vmax; height: 60vmax; border-radius: 50%; filter: blur(60px); opacity: .22; pointer-events: none;
      background: radial-gradient(circle at 40% 40%, rgba(45,212,191,.6), transparent 55%);
      animation: drift 24s ease-in-out infinite alternate;
    }
    .blob.b2 { background: radial-gradient(circle at 60% 60%, rgba(244,114,182,.6), transparent 55%); animation-duration: 28s; animation-delay: -4s; }
    .blob.b3 { background: radial-gradient(circle at 50% 50%, rgba(96,165,250,.6), transparent 55%); animation-duration: 30s; animation-delay: -8s; }
    @keyframes drift { from { transform: translate(-10%, -10%) scale(1); } to { transform: translate(10%, 10%) scale(1.08); } }

    /* Cards row with subtle entrance */
    .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; padding: 24px; max-width: 1100px; margin: 0 auto 40px; }
    .card.hero-card { opacity: 0; transform: translateY(10px); animation: rise .6s ease forwards; }
    .card.hero-card:nth-child(2) { animation-delay: .08s; }
    .card.hero-card:nth-child(3) { animation-delay: .16s; }
    @keyframes rise { to { opacity: 1; transform: translateY(0); } }
    /* Modal */
    .modal { position: fixed; inset: 0; display: grid; place-items: center; background: rgba(0,0,0,.55); z-index: 50; }
    .modal.hidden { display: none; }
    .modal .sheet { width: min(720px, 92vw); background: linear-gradient(180deg, var(--panel), var(--panel-2)); border: 1px solid var(--border); border-radius: 16px; padding: 16px; box-shadow: 0 20px 60px rgba(0,0,0,.5); }
    .modal .sheet .hd { display:flex; align-items:center; justify-content:space-between; font-weight:600; color: var(--text); margin-bottom: 8px; }
    .modal .sheet .bd { color: var(--muted); }
    .modal .sheet .ft { display:flex; gap:8px; justify-content:flex-end; margin-top: 12px; }
    /* Down chevron at bottom of hero */
    .down-cta {
      position: absolute; left: 50%; bottom: 18px; transform: translateX(-50%);
      width: 44px; height: 44px; border-radius: 999px;
      display: grid; place-items: center;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.12));
      color: var(--text);
      box-shadow: 0 10px 28px rgba(0,0,0,.35);
      cursor: pointer; transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
      animation: bob 2.4s ease-in-out infinite;
    }
    .down-cta:hover { border-color: rgba(255,255,255,.2); box-shadow: 0 12px 34px rgba(0,0,0,.45), 0 0 0 4px rgba(158,241,209,.08); }
    .down-cta:active { transform: translateX(-50%) translateY(1px); }
    .down-cta svg { width: 20px; height: 20px; opacity: .9; }
    @keyframes bob { 0%,100%{ transform: translateX(-50%) translateY(0); } 50%{ transform: translateX(-50%) translateY(4px); } }
  </style>
  <script type="module">
    // Tiny confetti bursts on load that loop at random, firing from random sides/angles
    window.addEventListener('load', () => {
      const container = document.createElement('div');
      container.style.position = 'fixed';
      container.style.inset = '0';
      container.style.pointerEvents = 'none';
      container.style.overflow = 'hidden';
      document.body.appendChild(container);

      const colors = ['#60a5fa','#f472b6','#2dd4bf','#ffd54f'];
      const parts = [];

      function spawnBurst(count=50){
        // Random origin: top, bottom, left, right, or center
        const side = ['top','bottom','left','right','center'][Math.floor(Math.random()*5)];
        const w = window.innerWidth; const h = window.innerHeight;
        let ox = w/2, oy = h/2;
        if (side==='top')    { ox = Math.random()*w; oy = -20; }
        if (side==='bottom') { ox = Math.random()*w; oy = h+20; }
        if (side==='left')   { ox = -20; oy = Math.random()*h; }
        if (side==='right')  { ox = w+20; oy = Math.random()*h; }

        for (let i=0;i<count;i++){
          const el = document.createElement('div');
          el.style.position = 'absolute';
          el.style.width = '6px'; el.style.height = '10px'; el.style.borderRadius = '2px';
          el.style.left = ox + 'px'; el.style.top = oy + 'px';
          el.style.background = colors[i % colors.length];
          el.style.opacity = '.95';
          el.style.transform = `rotate(${Math.random()*360}deg)`;
          container.appendChild(el);
          // Random direction and speed
          const ang = Math.random()*Math.PI*2; // 0..2PI any direction
          const spd = 2 + Math.random()*4;     // pixels/frame (scaled later)
          const vx = Math.cos(ang)*spd;
          const vy = Math.sin(ang)*spd;
          const vr = (Math.random()-.5)*6;     // deg/frame
          parts.push({ el, x: ox, y: oy, vx, vy, r: Math.random()*360, vr, life: 120 + Math.random()*80 });
        }
      }

      let last = performance.now();
      function step(now){
        const dt = Math.min(32, now - last) / 16.6; // normalize to ~60fps steps
        last = now;
        for (let i = parts.length-1; i>=0; i--) {
          const p = parts[i];
          // simple drag and gravity-ish drift
          p.vx *= 0.995; p.vy = p.vy*0.995 + 0.06;
          p.x += p.vx * dt; p.y += p.vy * dt; p.r += p.vr * dt; p.life -= dt;
          p.el.style.left = p.x + 'px'; p.el.style.top = p.y + 'px'; p.el.style.transform = `rotate(${p.r}deg)`;
          // Cull when off-screen or out of life
          if (p.life <= 0 || p.x < -60 || p.x > window.innerWidth+60 || p.y < -80 || p.y > window.innerHeight+80) {
            p.el.remove(); parts.splice(i,1);
          }
        }
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);

      // Kick off initial burst and then loop random bursts
      spawnBurst(60);
      function loop(){
        spawnBurst(40 + Math.floor(Math.random()*40));
        // Next burst between 3–8 seconds
        setTimeout(loop, 3000 + Math.random()*5000);
      }
      setTimeout(loop, 1800 + Math.random()*1200);
    });

    // Role selection modal
    const showRoleModal = async (role) => {
      const modal = document.getElementById('roleModal');
      const title = document.getElementById('roleTitle');
      const body = document.getElementById('roleBody');
      const play = document.getElementById('rolePlay');
      const cancel = document.getElementById('roleCancel');
      const isStreamer = role === 'streamer';
      title.textContent = isStreamer ? 'Play as Streamer' : 'Join as Zombie';
      // Streamer body with inline advanced config editor
      const streamerBody = `
        <div style="line-height:1.8">
          <div><strong>Move:</strong> WASD · <strong>Aim:</strong> Mouse · <strong>Shoot:</strong> Left‑click</div>
          <div><strong>Melee (bat):</strong> Right‑click or Q/E</div>
          <div><strong>Weapons:</strong> 1=Pistol · 2=SMG · 3=Shotgun</div>
          <div><strong>Dash:</strong> Space (1s CD) — brief burst</div>
          <div><strong>Scoring:</strong> Treasure adds <em>Score</em>. Dying clears current score.</div>
        </div>
        <details style="margin-top:10px">
          <summary style="cursor:pointer">Advanced: Edit Room Config (JSON)</summary>
          <div class="row" style="margin-top:8px">
            <textarea id="configEditor" class="mono" style="width:100%; height:220px"></textarea>
          </div>
          <div class="tip">Edit only what you need. Invalid JSON will be ignored.</div>
        </details>`;
      const zombieBody = `
        <div style="line-height:1.8">
          <div><strong>Move:</strong> WASD · <strong>Aim:</strong> Mouse · <strong>Ability:</strong> Left‑click</div>
          <div style="margin-top:6px"><strong>Classes:</strong></div>
          <div>• <span style=\"color:#64b5f6\">Runner</span>: Sprint burst on click (1.6× speed, 0.6× HP)</div>
          <div>• <span style=\"color:#ffa726\">Brute</span>: Charge toward cursor on click (0.7× speed, 2× HP, strong knockback)</div>
          <div>• <span style=\"color:#ba68c8\">Spitter</span>: Spit slow glob on click (damage + slow); also auto‑spits in range</div>
          <div style=\"margin-top:6px\">Touch the streamer to deal damage; coordinate to pin and overwhelm.</div>
        </div>`;
      body.innerHTML = isStreamer ? streamerBody : zombieBody;
      // Preload default config JSON if streamer
      if (isStreamer) {
        try {
          const res = await fetch('/config');
          if (res.ok) {
            const cfg = await res.json();
            const ed = document.getElementById('configEditor');
            if (ed) ed.value = JSON.stringify(cfg, null, 2);
          }
        } catch {}
      }
      play.onclick = async () => {
        if (isStreamer) {
          // Create room with optional overrides
          let overrides = undefined;
          const ed = document.getElementById('configEditor');
          if (ed && ed.value.trim()) {
            try { overrides = JSON.parse(ed.value); } catch { overrides = undefined; }
          }
          try {
            const res = await fetch('/create', { method: 'POST', headers: { 'content-type': 'application/json' }, body: JSON.stringify({ overrides }) });
            const data = await res.json();
            if (data && data.roomId) { window.location.href = `/streamer.html?room=${encodeURIComponent(data.roomId)}`; return; }
          } catch {}
          // Fallback
          window.location.href = '/streamer.html';
        } else {
          window.location.href = '/join.html';
        }
      };
      cancel.onclick = () => { modal.classList.add('hidden'); };
      modal.classList.remove('hidden');
    };

    document.addEventListener('click', (e) => {
      const t = e.target;
      if (!(t instanceof HTMLElement)) return;
      if (t.matches('#ctaStreamer')) { e.preventDefault(); showRoleModal('streamer'); }
      if (t.matches('#ctaZombie')) { e.preventDefault(); showRoleModal('zombie'); }
    });

    // Smooth scroll to How To Play
    const scrollBtn = document.getElementById('scrollDown');
    const howto = document.getElementById('howto');
    if (scrollBtn && howto) {
      scrollBtn.addEventListener('click', () => {
        try { howto.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
        catch { window.scrollTo({ top: howto.getBoundingClientRect().top + window.scrollY - 12, behavior: 'smooth' }); }
      });
    }
  </script>
</head>
<body>
  <div class="topbar">
    <div class="brand">Streamer vs. Chat</div>
    <div class="middle-controls">
      <span class="badge" id="status" data-state="disconnected">Welcome</span>
    </div>
    <div class="right-controls">
      <button class="primary" id="ctaStreamer">Streamer</button>
      <button id="ctaZombie">Join</button>
    </div>
  </div>
  <div class="hero">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="hero-inner">
      <div class="title">Streamer vs. Chat — Zombies</div>
      <div class="subtitle">A fast, top‑down arena: One streamer, many zombies. Loot treasure, survive the horde, and rack up a high score.</div>
      <div class="cta">
        <button class="btn-xl primary" id="ctaStreamer">Play as Streamer</button>
        <button class="btn-xl secondary" id="ctaZombie">Join as Zombie</button>
      </div>
    </div>
    <button id="scrollDown" class="down-cta" aria-label="Scroll to How To Play">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <div class="cards">
      <div class="card hero-card"><div class="card-title">20Hz Server</div><div class="tip">Authoritative sim with fair hits and clean rollback for inputs.</div></div>
      <div class="card hero-card"><div class="card-title">Relentless Pressure</div><div class="tip">Loot treasure to raise your score while dodging the swarm.</div></div>
      <div class="card hero-card"><div class="card-title">Chat vs. You</div><div class="tip">Hundreds of slow zombies, simple inputs, and satisfying chaos.</div></div>
    </div>
  </div>

  <div id="howto" class="cards" style="max-width:1100px; margin:0 auto 60px;">
    <div class="card hero-card">
      <div class="card-title">How To Play — Streamer</div>
      <div class="tip" style="line-height:1.7">
        <div><strong>Move:</strong> WASD · <strong>Aim:</strong> Mouse · <strong>Shoot:</strong> Left‑click</div>
        <div><strong>Melee (bat):</strong> Right‑click or Q/E · short arc</div>
        <div><strong>Weapons:</strong> 1=Pistol · 2=SMG · 3=Shotgun</div>
          <div><strong>Dash:</strong> Space (1s CD) · brief burst</div>
          <div><strong>Scoring:</strong> Treasure adds <em>Score</em>. Dying clears unbanked points.</div>
      </div>
    </div>
    <div class="card hero-card">
      <div class="card-title">How To Play — Zombie</div>
      <div class="tip" style="line-height:1.7">
        <div><strong>Move:</strong> WASD · <strong>Aim:</strong> Mouse</div>
        <div><strong>Ability (all classes):</strong> Left‑click</div>
        <div style="margin-top:6px"><strong>Classes:</strong></div>
        <div>• <span style="color:#64b5f6">Runner</span>: 1.6× speed, 0.6× HP. Left‑click = short sprint burst.</div>
        <div>• <span style="color:#ffa726">Brute</span>: 0.7× speed, 2× HP. Left‑click = charge toward cursor (strong knockback on hit).</div>
        <div>• <span style="color:#ba68c8">Spitter</span>: normal speed/HP. Left‑click = spit a slow purple glob (damage + slow). Also spits automatically in range.</div>
        <div style="margin-top:6px">Touching the streamer deals damage; coordinate to pin and overwhelm.</div>
      </div>
    </div>
  </div>

  <div class="cards" style="max-width:1100px; margin:0 auto 80px; grid-template-columns: 1fr;">
    <div class="card hero-card">
      <div class="card-title">Legend & Tips</div>
      <div class="tip" style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
        <div>
          <div><strong>Flow:</strong> Treasure increases score. Dying resets current score.</div>
          <div><strong>Minimap:</strong> Bottom‑right, zoomed to your position.</div>
        </div>
        <div>
          <div style="margin-bottom:4px"><strong>Zombie Class Rings:</strong></div>
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:4px"><span style="width:12px;height:12px;border-radius:999px;border:2px solid #64b5f6;display:inline-block"></span> Runner</div>
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:4px"><span style="width:12px;height:12px;border-radius:999px;border:3px solid #ffa726;display:inline-block"></span> Brute</div>
          <div style="display:flex; align-items:center; gap:8px"><span style="width:12px;height:12px;border-radius:999px;border:2px solid #ba68c8;display:inline-block"></span> Spitter</div>
        </div>
      </div>
    </div>
  </div>


  <!-- Role selection modal -->
  <div id="roleModal" class="modal hidden">
    <div class="sheet">
      <div class="hd"><span id="roleTitle">Play</span></div>
      <div class="bd" id="roleBody"></div>
      <div class="ft">
        <button id="roleCancel">Back</button>
        <button id="rolePlay" class="primary">Play</button>
      </div>
    </div>
  </div>
</body>
</html>
